<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RoomStream - Chat WebSocket Manager</title>
    <meta name="description" content="Interface de gerenciamento de salas de chat WebSocket em tempo real">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.5/dist/cdn.min.js"></script>
    
    <!-- Socket.IO Client -->
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#fef2f2',
                            100: '#fee2e2',
                            200: '#fecaca',
                            300: '#fca5a5',
                            400: '#f87171',
                            500: '#ef4444',
                            600: '#dc2626',
                            700: '#b91c1c',
                            800: '#991b1b',
                            900: '#7f1d1d',
                            950: '#450a0a'
                        },
                        tech: {
                            dark: '#0a0a0a',
                            darker: '#050505',
                            light: '#1a1a1a',
                            accent: '#ff3333'
                        }
                    },
                    animation: {
                        'pulse-soft': 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'slide-in': 'slideIn 0.3s ease-out',
                        'fade-in': 'fadeIn 0.5s ease-out'
                    },
                    keyframes: {
                        slideIn: {
                            '0%': { transform: 'translateX(-100%)', opacity: '0' },
                            '100%': { transform: 'translateX(0)', opacity: '1' }
                        },
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        [x-cloak] { display: none !important; }
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .dark .glass-effect {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>

<body class="bg-gray-50 dark:bg-tech-darker text-gray-900 dark:text-gray-100 transition-colors duration-300" 
      x-data="roomStreamApp()" x-init="init()">
    
    <!-- Header -->
    <header class="bg-white dark:bg-tech-dark shadow-lg border-b border-gray-200 dark:border-gray-800 sticky top-0 z-50">
        <div class="flex items-center justify-between px-6 py-4">
            <!-- Logo & Sidebar Toggle -->
            <div class="flex items-center space-x-4">
                <button @click="sidebarOpen = !sidebarOpen" 
                        class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
                    <i data-lucide="menu" class="w-5 h-5"></i>
                </button>
                
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-gradient-to-br from-primary-500 to-primary-700 rounded-lg flex items-center justify-center">
                        <i data-lucide="radio" class="w-5 h-5 text-white"></i>
                    </div>
                    <h1 class="text-xl font-bold bg-gradient-to-r from-primary-600 to-primary-800 bg-clip-text text-transparent">
                        RoomStream
                    </h1>
                </div>
            </div>

            <!-- Status & Theme Toggle -->
            <div class="flex items-center space-x-4">
                <!-- Connection Status -->
                <div class="flex items-center space-x-2 px-3 py-1.5 rounded-full" 
                     :class="connectionStatus === 'connected' ? 'bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-400' : 'bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-400'">
                    <div class="w-2 h-2 rounded-full" 
                         :class="connectionStatus === 'connected' ? 'bg-green-500 animate-pulse-soft' : 'bg-red-500'"></div>
                    <span class="text-sm font-medium" x-text="connectionStatus === 'connected' ? 'Online' : 'Offline'"></span>
                </div>

                <!-- Theme Toggle -->
                <button @click="toggleTheme()" 
                        class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
                    <i :data-lucide="isDark ? 'sun' : 'moon'" class="w-5 h-5"></i>
                </button>
            </div>
        </div>
    </header>

    <div class="flex h-screen pt-16">
        <!-- Sidebar -->
        <div class="fixed inset-y-16 left-0 z-40 transition-transform duration-300 ease-in-out"
             :class="sidebarOpen ? 'translate-x-0' : '-translate-x-full'">
            <nav class="h-full w-64 bg-white dark:bg-tech-dark shadow-xl border-r border-gray-200 dark:border-gray-800">
                <div class="p-4 space-y-2">
                    <a @click="currentView = 'dashboard'; sidebarOpen = false" 
                       :class="currentView === 'dashboard' ? 'bg-primary-50 dark:bg-primary-900/30 text-primary-700 dark:text-primary-400' : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800'"
                       class="flex items-center space-x-3 px-4 py-3 rounded-lg cursor-pointer transition-colors">
                        <i data-lucide="bar-chart-3" class="w-5 h-5"></i>
                        <span class="font-medium">Dashboard</span>
                    </a>
                    
                    <a @click="currentView = 'rooms'; sidebarOpen = false" 
                       :class="currentView === 'rooms' ? 'bg-primary-50 dark:bg-primary-900/30 text-primary-700 dark:text-primary-400' : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800'"
                       class="flex items-center space-x-3 px-4 py-3 rounded-lg cursor-pointer transition-colors">
                        <i data-lucide="users" class="w-5 h-5"></i>
                        <span class="font-medium">Salas</span>
                    </a>
                    
                    <a @click="currentView = 'settings'; sidebarOpen = false" 
                       :class="currentView === 'settings' ? 'bg-primary-50 dark:bg-primary-900/30 text-primary-700 dark:text-primary-400' : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800'"
                       class="flex items-center space-x-3 px-4 py-3 rounded-lg cursor-pointer transition-colors">
                        <i data-lucide="settings" class="w-5 h-5"></i>
                        <span class="font-medium">Configurações</span>
                    </a>
                </div>
            </nav>
        </div>

        <!-- Overlay -->
        <div x-show="sidebarOpen" 
             @click="sidebarOpen = false"
             x-transition:enter="transition-opacity ease-linear duration-300"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             x-transition:leave="transition-opacity ease-linear duration-300"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0"
             class="fixed inset-0 bg-black bg-opacity-25 lg:hidden z-30"></div>

        <!-- Main Content -->
        <main class="flex-1 p-6 overflow-auto" :class="sidebarOpen ? 'lg:ml-64' : ''">
            
            <!-- Dashboard View -->
            <div x-show="currentView === 'dashboard'" x-transition class="space-y-6">
                <div class="flex items-center justify-between">
                    <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Dashboard</h2>
                    <button @click="loadMetrics()" 
                            class="flex items-center space-x-2 px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-lg transition-colors">
                        <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                        <span>Atualizar</span>
                    </button>
                </div>

                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="bg-white dark:bg-tech-light rounded-xl shadow-lg p-6 border border-gray-200 dark:border-gray-700">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Total de Salas</p>
                                <p class="text-3xl font-bold text-gray-900 dark:text-white" x-text="metrics.totalRooms || 0"></p>
                            </div>
                            <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center">
                                <i data-lucide="users" class="w-6 h-6 text-blue-600 dark:text-blue-400"></i>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-tech-light rounded-xl shadow-lg p-6 border border-gray-200 dark:border-gray-700">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Clientes Conectados</p>
                                <p class="text-3xl font-bold text-gray-900 dark:text-white" x-text="metrics.totalClients || 0"></p>
                            </div>
                            <div class="w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center">
                                <i data-lucide="wifi" class="w-6 h-6 text-green-600 dark:text-green-400"></i>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-tech-light rounded-xl shadow-lg p-6 border border-gray-200 dark:border-gray-700">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Mensagens Enviadas</p>
                                <p class="text-3xl font-bold text-gray-900 dark:text-white" x-text="metrics.totalMessages || 0"></p>
                            </div>
                            <div class="w-12 h-12 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center">
                                <i data-lucide="message-circle" class="w-6 h-6 text-purple-600 dark:text-purple-400"></i>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-tech-light rounded-xl shadow-lg p-6 border border-gray-200 dark:border-gray-700">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Uptime</p>
                                <p class="text-lg font-bold text-gray-900 dark:text-white" x-text="formatUptime(metrics.uptime || 0)"></p>
                            </div>
                            <div class="w-12 h-12 bg-orange-100 dark:bg-orange-900/30 rounded-lg flex items-center justify-center">
                                <i data-lucide="clock" class="w-6 h-6 text-orange-600 dark:text-orange-400"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Active Rooms -->
                <div class="bg-white dark:bg-tech-light rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                    <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Salas Mais Ativas</h3>
                    </div>
                    <div class="p-6">
                        <template x-if="rooms.length === 0">
                            <p class="text-gray-500 dark:text-gray-400 text-center py-8">Nenhuma sala encontrada</p>
                        </template>
                        <div class="space-y-4">
                            <template x-for="room in rooms.slice(0, 5)" :key="room.id">
                                <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-tech-darker rounded-lg">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-primary-100 dark:bg-primary-900/30 rounded-lg flex items-center justify-center">
                                            <i data-lucide="hash" class="w-5 h-5 text-primary-600 dark:text-primary-400"></i>
                                        </div>
                                        <div>
                                            <h4 class="font-medium text-gray-900 dark:text-white" x-text="room.name"></h4>
                                            <p class="text-sm text-gray-500 dark:text-gray-400" x-text="`${room.participants.length} participantes`"></p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-sm font-medium text-gray-900 dark:text-white" x-text="`${room.messages.length} mensagens`"></p>
                                        <p class="text-xs text-gray-500 dark:text-gray-400" x-text="formatDate(room.createdAt)"></p>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Rooms View -->
            <div x-show="currentView === 'rooms'" x-transition class="space-y-6">
                <div class="flex items-center justify-between">
                    <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Gerenciar Salas</h2>
                    <button @click="showCreateRoom = true" 
                            class="flex items-center space-x-2 px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-lg transition-colors">
                        <i data-lucide="plus" class="w-4 h-4"></i>
                        <span>Nova Sala</span>
                    </button>
                </div>

                <!-- Rooms List -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <template x-for="room in rooms" :key="room.id">
                        <div class="bg-white dark:bg-tech-light rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 hover:shadow-xl transition-all duration-300 group">
                            <div class="p-6">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="w-12 h-12 bg-primary-100 dark:bg-primary-900/30 rounded-lg flex items-center justify-center">
                                        <i data-lucide="hash" class="w-6 h-6 text-primary-600 dark:text-primary-400"></i>
                                    </div>
                                    <div class="flex space-x-2 opacity-0 group-hover:opacity-100 transition-opacity">
                                        <button @click="joinRoom(room.id)" 
                                                class="p-2 text-green-600 hover:bg-green-100 dark:hover:bg-green-900/30 rounded-lg transition-colors">
                                            <i data-lucide="log-in" class="w-4 h-4"></i>
                                        </button>
                                        <button @click="deleteRoom(room.id)" 
                                                class="p-2 text-red-600 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-lg transition-colors">
                                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2" x-text="room.name"></h3>
                                
                                <div class="space-y-2 text-sm text-gray-600 dark:text-gray-400">
                                    <div class="flex items-center space-x-2">
                                        <i data-lucide="users" class="w-4 h-4"></i>
                                        <span x-text="`${room.participants.length} participantes`"></span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <i data-lucide="message-circle" class="w-4 h-4"></i>
                                        <span x-text="`${room.messages.length} mensagens`"></span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <i data-lucide="calendar" class="w-4 h-4"></i>
                                        <span x-text="formatDate(room.createdAt)"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>

            <!-- Settings View -->
            <div x-show="currentView === 'settings'" x-transition class="space-y-6">
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Configurações</h2>
                
                <div class="bg-white dark:bg-tech-light rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 p-6">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Conexão WebSocket</h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                URL Base do Backend
                            </label>
                            <input type="text" x-model="settings.baseUrl" 
                                   class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-tech-darker text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Namespace WebSocket
                            </label>
                            <input type="text" x-model="settings.namespace" 
                                   class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-tech-darker text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                        </div>
                        
                        <button @click="saveSettings()" 
                                class="flex items-center space-x-2 px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-lg transition-colors">
                            <i data-lucide="save" class="w-4 h-4"></i>
                            <span>Salvar Configurações</span>
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Chat Sidebar -->
        <div x-show="chatOpen" 
             x-transition:enter="transition-transform ease-out duration-300"
             x-transition:enter-start="translate-x-full"
             x-transition:enter-end="translate-x-0"
             x-transition:leave="transition-transform ease-in duration-300"
             x-transition:leave-start="translate-x-0"
             x-transition:leave-end="translate-x-full"
             class="fixed right-0 top-16 bottom-0 w-80 bg-white dark:bg-tech-light shadow-xl border-l border-gray-200 dark:border-gray-700 z-50">
            
            <!-- Chat Header -->
            <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between">
                <div>
                    <h3 class="font-semibold text-gray-900 dark:text-white" x-text="currentRoom?.name || 'Chat'"></h3>
                    <p class="text-sm text-gray-500 dark:text-gray-400" x-text="`${currentRoom?.participants?.length || 0} participantes`"></p>
                </div>
                <button @click="leaveCurrentRoom()" 
                        class="p-2 text-gray-500 hover:text-red-600 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-lg transition-colors">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            
            <!-- Messages -->
            <div class="flex-1 overflow-y-auto p-4 space-y-3" style="height: calc(100vh - 200px);">
                <template x-for="message in messages" :key="message.id">
                    <div class="flex items-start space-x-3">
                        <div class="w-8 h-8 bg-primary-100 dark:bg-primary-900/30 rounded-full flex items-center justify-center">
                            <i data-lucide="user" class="w-4 h-4 text-primary-600 dark:text-primary-400"></i>
                        </div>
                        <div class="flex-1">
                            <div class="bg-gray-100 dark:bg-tech-darker rounded-lg p-3">
                                <p class="text-sm text-gray-900 dark:text-white" x-text="message.message"></p>
                            </div>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1" x-text="formatTime(message.timestamp)"></p>
                        </div>
                    </div>
                </template>
            </div>
            
            <!-- Message Input -->
            <div class="p-4 border-t border-gray-200 dark:border-gray-700">
                <div class="flex space-x-2">
                    <input type="text" x-model="newMessage" @keyup.enter="sendMessage()"
                           placeholder="Digite sua mensagem..."
                           class="flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-tech-darker text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                    <button @click="sendMessage()" 
                            class="px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-lg transition-colors">
                        <i data-lucide="send" class="w-4 h-4"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Room Modal -->
    <div x-show="showCreateRoom" 
         x-transition:enter="transition-opacity ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition-opacity ease-in duration-300"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        
        <div class="bg-white dark:bg-tech-light rounded-xl shadow-xl p-6 w-full max-w-md m-4"
             @click.away="showCreateRoom = false">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Criar Nova Sala</h3>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Nome da Sala
                    </label>
                    <input type="text" x-model="newRoomName" @keyup.enter="createRoom()"
                           class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-tech-darker text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                           placeholder="Digite o nome da sala">
                </div>
                
                <div class="flex space-x-3 pt-4">
                    <button @click="createRoom()" 
                            class="flex-1 px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-lg transition-colors">
                        Criar
                    </button>
                    <button @click="showCreateRoom = false; newRoomName = ''" 
                            class="flex-1 px-4 py-2 bg-gray-300 hover:bg-gray-400 text-gray-700 rounded-lg transition-colors">
                        Cancelar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        function roomStreamApp() {
            return {
                // State
                currentView: 'dashboard',
                sidebarOpen: false,
                chatOpen: false,
                showCreateRoom: false,
                isDark: false,
                connectionStatus: 'disconnected',
                
                // Data
                rooms: [],
                metrics: {},
                messages: [],
                currentRoom: null,
                newMessage: '',
                newRoomName: '',
                
                // Settings
                settings: {
                    baseUrl: 'http://localhost:3000',
                    namespace: '/room'
                },
                
                // Socket
                socket: null,
                
                // Initialize
                init() {
                    this.loadSettings();
                    this.initTheme();
                    this.connectSocket();
                    this.loadRooms();
                    this.loadMetrics();
                    this.checkHealth();
                    
                    // Auto refresh
                    setInterval(() => {
                        this.loadMetrics();
                        this.checkHealth();
                    }, 30000);
                    
                    // Initialize Lucide icons
                    setTimeout(() => {
                        if (window.lucide) {
                            lucide.createIcons();
                        }
                    }, 100);
                },
                
                // Theme
                initTheme() {
                    this.isDark = localStorage.getItem('theme') === 'dark' || 
                                 (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches);
                    this.updateTheme();
                },
                
                toggleTheme() {
                    this.isDark = !this.isDark;
                    this.updateTheme();
                    localStorage.setItem('theme', this.isDark ? 'dark' : 'light');
                },
                
                updateTheme() {
                    if (this.isDark) {
                        document.documentElement.classList.add('dark');
                    } else {
                        document.documentElement.classList.remove('dark');
                    }
                },
                
                // Settings
                loadSettings() {
                    const saved = localStorage.getItem('roomstream-settings');
                    if (saved) {
                        this.settings = { ...this.settings, ...JSON.parse(saved) };
                    }
                },
                
                saveSettings() {
                    localStorage.setItem('roomstream-settings', JSON.stringify(this.settings));
                    this.connectSocket(); // Reconnect with new settings
                    alert('Configurações salvas!');
                },
                
                // Socket Connection
                connectSocket() {
                    if (this.socket) {
                        this.socket.disconnect();
                    }
                    
                    try {
                        this.socket = io(this.settings.baseUrl + this.settings.namespace);
                        
                        this.socket.on('connect', () => {
                            this.connectionStatus = 'connected';
                            console.log('Connected to WebSocket');
                        });
                        
                        this.socket.on('disconnect', () => {
                            this.connectionStatus = 'disconnected';
                            console.log('Disconnected from WebSocket');
                        });
                        
                        // Chat events
                        this.socket.on('newMessage', (message) => {
                            this.messages.push(message);
                        });
                        
                        this.socket.on('userJoined', (data) => {
                            console.log('User joined:', data);
                        });
                        
                        this.socket.on('userLeft', (data) => {
                            console.log('User left:', data);
                        });
                        
                        this.socket.on('joinedRoom', (data) => {
                            this.currentRoom = data;
                            this.messages = data.recentMessages || [];
                            this.chatOpen = true;
                        });
                        
                        this.socket.on('error', (error) => {
                            alert('Error: ' + error.message);
                        });
                        
                    } catch (error) {
                        console.error('Socket connection error:', error);
                        this.connectionStatus = 'disconnected';
                    }
                },
                
                // API Calls
                async loadRooms() {
                    try {
                        const response = await fetch(`${this.settings.baseUrl}/room`);
                        if (response.ok) {
                            this.rooms = await response.json();
                        }
                    } catch (error) {
                        console.error('Error loading rooms:', error);
                    }
                },
                
                async loadMetrics() {
                    try {
                        const response = await fetch(`${this.settings.baseUrl}/metrics`);
                        if (response.ok) {
                            this.metrics = await response.json();
                        }
                    } catch (error) {
                        console.error('Error loading metrics:', error);
                    }
                },
                
                async checkHealth() {
                    try {
                        const response = await fetch(`${this.settings.baseUrl}/health`);
                        // Health check doesn't change connection status, just validates API
                    } catch (error) {
                        console.error('Health check failed:', error);
                    }
                },
                
                async createRoom() {
                    if (!this.newRoomName.trim()) return;
                    
                    try {
                        const response = await fetch(`${this.settings.baseUrl}/room`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ name: this.newRoomName })
                        });
                        
                        if (response.ok) {
                            this.showCreateRoom = false;
                            this.newRoomName = '';
                            this.loadRooms();
                        }
                    } catch (error) {
                        console.error('Error creating room:', error);
                        alert('Erro ao criar sala');
                    }
                },
                
                async deleteRoom(roomId) {
                    if (!confirm('Tem certeza que deseja deletar esta sala?')) return;
                    
                    try {
                        const response = await fetch(`${this.settings.baseUrl}/room/${roomId}`, {
                            method: 'DELETE'
                        });
                        
                        if (response.ok) {
                            this.loadRooms();
                        }
                    } catch (error) {
                        console.error('Error deleting room:', error);
                        alert('Erro ao deletar sala');
                    }
                },
                
                // Room Actions
                joinRoom(roomId) {
                    if (this.socket && this.socket.connected) {
                        this.socket.emit('joinRoom', { 
                            roomId, 
                            participantName: 'User_' + Math.random().toString(36).substr(2, 9)
                        });
                    } else {
                        alert('WebSocket não conectado');
                    }
                },
                
                leaveCurrentRoom() {
                    if (this.socket && this.currentRoom) {
                        this.socket.emit('leaveRoom', { roomId: this.currentRoom.roomId });
                        this.currentRoom = null;
                        this.messages = [];
                        this.chatOpen = false;
                    }
                },
                
                sendMessage() {
                    if (!this.newMessage.trim() || !this.socket || !this.currentRoom) return;
                    
                    this.socket.emit('sendMessage', {
                        roomId: this.currentRoom.roomId,
                        message: this.newMessage
                    });
                    
                    this.newMessage = '';
                },
                
                // Utilities
                formatUptime(ms) {
                    const seconds = Math.floor(ms / 1000);
                    const minutes = Math.floor(seconds / 60);
                    const hours = Math.floor(minutes / 60);
                    const days = Math.floor(hours / 24);
                    
                    if (days > 0) return `${days}d ${hours % 24}h`;
                    if (hours > 0) return `${hours}h ${minutes % 60}m`;
                    return `${minutes}m ${seconds % 60}s`;
                },
                
                formatDate(dateString) {
                    return new Date(dateString).toLocaleDateString('pt-BR');
                },
                
                formatTime(dateString) {
                    return new Date(dateString).toLocaleTimeString('pt-BR', { 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    });
                }
            }
        }
    </script>
</body>
</html>